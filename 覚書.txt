/ (リポジトリのルート)
├── index.html            <-- これがトップページ (表側の画面：APIキーは書かない)
└── netlify/              <-- フォルダ
    └── functions/        <-- その中のフォルダ
        ├── .gitkeep      <-- フォルダ維持用
        └── chat.js       <-- AI機能用プログラム(裏側の処理：ここでAPIキーを使う)


GitHubでの操作のコツ
もしこれから GitHub の画面上で netlify/functions/chat.js を作ろうとされる場合、GitHubには「フォルダだけ作る」というボタンがありません。以下の手順で**「一気に」**名前を入力するのがコツです。

[Add file] ➔ [Create new file] を押す。
ファイル名の入力欄に netlify/functions/chat.js とスラッシュを含めて入力する。
スラッシュを入力するたびに、自動的にフォルダの形に切り替わります。
中身にコードを貼り付けて [Commit changes] を押す。


chat.jsの書き方

// netlify/functions/chat.js
exports.handler = async (event) => {
  // 自分のAPIキーをNetlifyの設定から読み込む（後述）
  const API_KEY = process.env.GEMINI_API_KEY; 
  
  const body = JSON.parse(event.body);

  try {
    const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${API_KEY}`, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        contents: [{ parts: [{ text: body.prompt }] }]
      })
    });

    const data = await response.json();
    return {
      statusCode: 200,
      body: JSON.stringify(data)
    };
  } catch (error) {
    return { statusCode: 500, body: error.toString() };
  }
};



3. 表側の画面：index.html の修正
これまでは直接Googleにリクエストを送っていましたが、今度からは**自分のサーバー（Netlify Function）**に送るように書き換えます。


// index.html 内のAIを呼び出す部分
async function askAI(prompt) {
  const response = await fetch('/.netlify/functions/chat', { // ここが中継地点のURL
    method: 'POST',
    body: JSON.stringify({ prompt: prompt })
  });
  const data = await response.json();
  return data.candidates[0].content.parts[0].text;
}



4. Netlifyの管理画面で「鍵」を登録する
最後に、本物のAPIキーをNetlifyに教えます。これを行うことで、コードの中にキーを書かなくてよくなります。

Netlifyの管理画面で自分のサイト（v-g-a）を開く。

Site configuration ＞ Environment variables をクリック。
Add a variable をクリック。
Key: GEMINI_API_KEY
Value: (Google AI Studioで取得した本物のキー)

保存します。
